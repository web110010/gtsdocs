<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Apache HTTP Server # In order to use Apache as a reverse proxy for GoToSocial you&rsquo;ll need to have it installed on your server. If you intend for the Apache instance to also handle TLS, you&rsquo;ll need to provision TLS certificates too.
Apache is packaged for many distributions. It&rsquo;s very likely you can install it with your distribution&rsquo;s package manager. You can also run Apache using a container runtime with the official Apache image that&rsquo;s published to the Docker Hub.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="Apache HTTP Server # In order to use Apache as a reverse proxy for GoToSocial you&rsquo;ll need to have it installed on your server. If you intend for the Apache instance to also handle TLS, you&rsquo;ll need to provision TLS certificates too.
Apache is packaged for many distributions. It&rsquo;s very likely you can install it with your distribution&rsquo;s package manager. You can also run Apache using a container runtime with the official Apache image that&rsquo;s published to the Docker Hub." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/docs/getting_started/reverse_proxy/apache-httpd/" /><meta property="article:section" content="docs" />



<title>Apache Httpd |  GoToSocial Documentation </title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.f8de3645fe00591b41524aee174e19edd98a22255a2930a0cdc82a94835ba387.css" integrity="sha256-&#43;N42Rf4AWRtBUkruF04Z7dmKIiVaKTCgzcgqlINbo4c=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.611c5c1febb7934f5bf0513e18b80edbb8ef94a70c6bcfdb5d454501232b51e4.js" integrity="sha256-YRxcH&#43;u3k09b8FE&#43;GLgO27jvlKcMa8/bXUVFASMrUeQ=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
  <link href="/css/swagger-css/swagger-ui.css" rel="stylesheet" type="text/css">
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/favicon.ico" alt="Logo" /><span> GoToSocial Documentation </span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/docs/faq/" class="">FAQ</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0b8a4f04ff43ad74e1f0264bbdf6f4e1" class="toggle"  />
    <label for="section-0b8a4f04ff43ad74e1f0264bbdf6f4e1" class="flex justify-between">
      <a role="button" class="">User Guide</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/user_guide/posts/" class="">Posts</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/user_guide/settings/" class="">Settings</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/user_guide/custom_css/" class="">Custom CSS (Advanced)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/user_guide/password_management/" class="">Password Management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/user_guide/rss/" class="">RSS</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d0d8c0b66b8e3c4a41d9a7a903279018" class="toggle" checked />
    <label for="section-d0d8c0b66b8e3c4a41d9a7a903279018" class="flex justify-between">
      <a role="button" class="">Getting Started</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/getting_started/deployment_considerations/" class="">Deployment Considerations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getting_started/releases/" class="">Releases</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-4dd3c8f7579de11397af9a616dd97623" class="toggle"  />
    <label for="section-4dd3c8f7579de11397af9a616dd97623" class="flex justify-between">
      <a href="/docs/getting_started/installation/" class="">Installation</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/getting_started/installation/metal/" class="">Bare metal</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getting_started/installation/container/" class="">Container</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-227ed35e8d3d1d9ae6ada088eaa5826a" class="toggle" checked />
    <label for="section-227ed35e8d3d1d9ae6ada088eaa5826a" class="flex justify-between">
      <a href="/docs/getting_started/reverse_proxy/" class="">Reverse Proxy</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/getting_started/reverse_proxy/nginx/" class="">Nginx</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getting_started/reverse_proxy/apache-httpd/" class="active">Apache Httpd</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getting_started/reverse_proxy/caddy/" class="">Caddy 2</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getting_started/reverse_proxy/websocket/" class="">Websocket</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getting_started/user_creation/" class="">User Creation</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-733eb6bf92c2240d3439f44b52d0e508" class="toggle"  />
    <label for="section-733eb6bf92c2240d3439f44b52d0e508" class="flex justify-between">
      <a href="/docs/configuration/" class="">Configuration</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/general/" class="">General</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/database/" class="">Database</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/web/" class="">Web</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/instance/" class="">Instance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/accounts/" class="">Accounts</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/media/" class="">Media</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/storage/" class="">Storage</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/statuses/" class="">Statuses</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/tls/" class="">TLS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/oidc/" class="">OpenID Connect (OIDC)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/smtp/" class="">Email Config (smtp)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/syslog/" class="">Syslog</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/advanced/" class="">Advanced</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/configuration/observability/" class="">Observability</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-947fb6d312b5241daf9523c924869228" class="toggle"  />
    <label for="section-947fb6d312b5241daf9523c924869228" class="flex justify-between">
      <a href="/docs/advanced/" class="">Advanced</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/host-account-domain/" class="">Split-domain deployments</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/outgoing-proxy/" class="">Outgoing HTTP proxy</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-76875d46ccfca56452024158a33d8109" class="toggle"  />
    <label for="section-76875d46ccfca56452024158a33d8109" class="flex justify-between">
      <a href="/docs/advanced/caching/" class="">Caching</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/caching/api/" class="">API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/caching/assets-media/" class="">Assets Media</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/certificates/" class="">Provisioning TLS certificates</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-010cc1241fb55df50712cba4c805f74e" class="toggle"  />
    <label for="section-010cc1241fb55df50712cba4c805f74e" class="flex justify-between">
      <a href="/docs/advanced/security/" class="">Security</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/security/sandboxing/" class="">Application sandboxing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/security/firewall/" class="">Firewall</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/tracing/" class="">Tracing</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d3501c3f4c7ea3fb09a3bb156b24beda" class="toggle"  />
    <label for="section-d3501c3f4c7ea3fb09a3bb156b24beda" class="flex justify-between">
      <a role="button" class="">Admin</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/admin/settings/" class="">Admin Settings</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/admin/cli/" class="">GtS CLI Tool</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/admin/backup_and_restore/" class="">Backup and Restore</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-901779afe5996ea4448e3bb3d55a2b9f" class="toggle"  />
    <label for="section-901779afe5996ea4448e3bb3d55a2b9f" class="flex justify-between">
      <a href="/docs/federation/" class="">Federation</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/federation/glossary/" class="">Glossary</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/federation/federating_with_gotosocial/" class="">Federating With Gotosocial</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bf7b3283e3790c00c8caaa140299052b" class="toggle"  />
    <label for="section-bf7b3283e3790c00c8caaa140299052b" class="flex justify-between">
      <a role="button" class="">API</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/api/swagger/" class="">Swagger</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/api/ratelimiting/" class="">Request Rate Limiting</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/api/throttling/" class="">Request Throttling</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Apache Httpd</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#configure-gotosocial">Configure GoToSocial</a></li>
    <li><a href="#set-up-apache">Set up Apache</a>
      <ul>
        <li><a href="#required-apache-modules">Required Apache modules</a></li>
        <li><a href="#tls-with-mod_md">TLS with mod_md</a></li>
        <li><a href="#tls-with-externally-managed-certificates">TLS with externally managed certificates</a></li>
      </ul>
    </li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="apache-http-server">
  Apache HTTP Server
  <a class="anchor" href="#apache-http-server">#</a>
</h1>
<p>In order to use Apache as a reverse proxy for GoToSocial you&rsquo;ll need to have it installed on your server. If you intend for the Apache instance to also handle TLS, you&rsquo;ll need to <a href="../../../advanced/certificates">provision TLS certificates</a> too.</p>
<p>Apache is <a href="https://repology.org/project/apache/versions">packaged for many distributions</a>. It&rsquo;s very likely you can install it with your distribution&rsquo;s package manager. You can also run Apache using a container runtime with the <a href="https://hub.docker.com/_/httpd">official Apache image</a> that&rsquo;s published to the Docker Hub.</p>
<p>In this guide we&rsquo;ll also show how to use certbot to provision the TLS certificates. It too is <a href="https://repology.org/project/certbot/versions">packaged in many distributions</a> but many distributions tend to ship fairly old versions of certbot. If you run into trouble it may be worth considering using the <a href="https://hub.docker.com/r/certbot/certbot">container image</a> instead.</p>
<h2 id="configure-gotosocial">
  Configure GoToSocial
  <a class="anchor" href="#configure-gotosocial">#</a>
</h2>
<p>We&rsquo;re going to have Apache handle LetsEncrypt certificates, so you need to turn off built-in LetsEncrypt support in your GoToSocial config.</p>
<p>First open the file in your text editor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudoedit /gotosocial/config.yaml
</span></span></code></pre></div><p>Then set <code>letsencrypt-enabled: false</code>.</p>
<p>If the reverse proxy will be running on the same machine, set the <code>bind-address</code> to <code>&quot;localhost&quot;</code> so that the GoToSocial server is only accessible via loopback. Otherwise it may be possible to bypass your proxy by connecting to GoToSocial directly, which might be undesirable.</p>
<p>If GoToSocial is already running, restart it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl restart gotosocial.service
</span></span></code></pre></div><p>Or if you don&rsquo;t have a systemd service just restart it manually.</p>
<h2 id="set-up-apache">
  Set up Apache
  <a class="anchor" href="#set-up-apache">#</a>
</h2>
<h3 id="required-apache-modules">
  Required Apache modules
  <a class="anchor" href="#required-apache-modules">#</a>
</h3>
<p>You need to ensure you have a number of Apache modules installed and enabled. All these modules <em>should</em> ship with your distribution&rsquo;s Apache package, but they may have been split out into separate packages.</p>
<p>You can check which modules you have installed with <code>apachectl -M</code>.</p>
<p>You&rsquo;ll need to have the following modules loaded:</p>
<ul>
<li><code>proxy_http</code> to proxy HTTP requests to GoToSocial</li>
<li><code>ssl</code> to handle SSL/TLS</li>
<li><code>headers</code> to manipulate HTTP request and response headers</li>
<li><code>rewrite</code> to rewrite HTTP requests</li>
<li><code>md</code> for Lets Encrypt, available since 2.4.30</li>
</ul>
<p>On Debian, Ubuntu and openSUSE, you can use the <a href="https://manpages.debian.org/bookworm/apache2/a2enmod.8.en.html"><code>a2enmod</code></a> utility to load any additional modules. For the Red Hat/CentOS family of distributions, you&rsquo;ll need to add a <a href="https://httpd.apache.org/docs/2.4/mod/mod_so.html#loadmodule"><code>LoadModule</code> directive</a> to your Apache configuration instead.</p>
<h3 id="tls-with-mod_md">
  TLS with mod_md
  <a class="anchor" href="#tls-with-mod_md">#</a>
</h3>
<p><blockquote class="book-hint info">
  <p><strong>Note</strong></p>
<p><code>mod_md</code> is only available since Apache 2.4.30 and still considered experimental. It works well enough in practice and is the most convenient method.</p>

</blockquote>

Now we&rsquo;ll configure Apache HTTP Server to serve GoToSocial requests.</p>
<p>First we&rsquo;ll write a configuration for Apache HTTP Server and put it in <code>/etc/apache2/sites-available</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mkdir -p /etc/apache2/sites-available/
</span></span><span style="display:flex;"><span>sudoedit /etc/apache2/sites-available/example.com.conf
</span></span></code></pre></div><p>In the above <code>sudoedit</code> command, replace <code>example.com</code> with the hostname of your GoToSocial server.</p>
<p>The file you&rsquo;re about to create should look a bit like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-apache" data-lang="apache"><span style="display:flex;"><span>MDomain example.com auto
</span></span><span style="display:flex;"><span>MDCertificateAgreement accepted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;VirtualHost</span> <span style="color:#e6db74">*:80 </span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  ServerName example.com
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/VirtualHost&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;VirtualHost</span> <span style="color:#e6db74">*:443</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  ServerName example.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  RewriteEngine <span style="color:#66d9ef">On</span>
</span></span><span style="display:flex;"><span>  RewriteCond %{HTTP:Upgrade} websocket [NC]
</span></span><span style="display:flex;"><span>  RewriteCond %{HTTP:Connection} upgrade [NC]
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># set to 127.0.0.1 instead of localhost to work around https://stackoverflow.com/a/52550758</span>
</span></span><span style="display:flex;"><span>  RewriteRule ^/?(.*) <span style="color:#e6db74">&#34;ws://127.0.0.1:8080/$1&#34;</span> [P,L]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  SSLEngine <span style="color:#66d9ef">On</span>
</span></span><span style="display:flex;"><span>  ProxyPreserveHost <span style="color:#66d9ef">On</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># set to 127.0.0.1 instead of localhost to work around https://stackoverflow.com/a/52550758</span>
</span></span><span style="display:flex;"><span>  ProxyPass / http://127.0.0.1:8080/
</span></span><span style="display:flex;"><span>  ProxyPassReverse / http://127.0.0.1:8080/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  RequestHeader set <span style="color:#e6db74">&#34;X-Forwarded-Proto&#34;</span> expr=https
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/VirtualHost&gt;</span>
</span></span></code></pre></div><p>or, if you have <a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy.html#protoupgrade">Apache httpd 2.4.47+</a>, you can get rid of both <code>mod_rewrite</code> and <code>mod_proxy_wstunnel</code> and simplify the whole config to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-apache" data-lang="apache"><span style="display:flex;"><span>MDomain example.com auto
</span></span><span style="display:flex;"><span>MDCertificateAgreement accepted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;VirtualHost</span> <span style="color:#e6db74">*:80 </span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  ServerName example.com
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/VirtualHost&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;VirtualHost</span> <span style="color:#e6db74">*:443</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  ServerName example.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  SSLEngine <span style="color:#66d9ef">On</span>
</span></span><span style="display:flex;"><span>  ProxyPreserveHost <span style="color:#66d9ef">On</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># set to 127.0.0.1 instead of localhost to work around https://stackoverflow.com/a/52550758</span>
</span></span><span style="display:flex;"><span>  ProxyPass / http://127.0.0.1:8080/ upgrade=websocket
</span></span><span style="display:flex;"><span>  ProxyPassReverse / http://127.0.0.1:8080/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  RequestHeader set <span style="color:#e6db74">&#34;X-Forwarded-Proto&#34;</span> expr=https
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/VirtualHost&gt;</span>
</span></span></code></pre></div><p>Again, replace occurrences of <code>example.com</code> in the above config file with the hostname of your GtS server. If your domain name is <code>gotosocial.example.com</code>, then <code>gotosocial.example.com</code> would be the correct value.</p>
<p>You should also change <code>http://127.0.0.1:8080</code> to the correct address and port (if it&rsquo;s not on <code>127.0.0.1:8080</code>) of your GtS server. For example, if you&rsquo;re running GoToSocial on another machine with the local ip of <code>192.168.178.69</code> and on port <code>8080</code> then <code>http://192.168.178.69:8080/</code> would be the correct value.</p>
<p><code>Rewrite*</code> directives are needed to ensure that Websocket streaming connections also work. See the <a href="../websocket">websocket</a> document for more information on this.</p>
<p><code>ProxyPreserveHost On</code> is essential: It guarantees that the proxy and the GoToSocial speak of the same Server name. If not, GoToSocial will build the wrong authentication headers, and all attempts at federation will be rejected with 401 Unauthorized.</p>
<p>By default, apache sets <code>X-Forwarded-For</code> in forwarded requests. To make this and rate limiting work, set the <code>trusted-proxies</code> configuration variable. See the <a href="../../../api/ratelimiting">rate limiting</a> and <a href="../../../configuration/general">general configuration</a> docs</p>
<p>Save and close the config file.</p>
<p>Now we&rsquo;ll need to link the file we just created to the folder that Apache HTTP Server reads configurations for active sites from.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mkdir /etc/apache2/sites-enabled
</span></span><span style="display:flex;"><span>sudo ln -s /etc/apache2/sites-available/example.com.conf /etc/apache2/sites-enabled/
</span></span></code></pre></div><p>In the above <code>ln</code> command, replace <code>example.com</code> with the hostname of your GoToSocial server.</p>
<p>Now check for configuration errors.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apachectl -t
</span></span></code></pre></div><p>If everything is fine you should get this as output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Syntax OK
</span></span></code></pre></div><p>Everything working? Great! Then restart Apache HTTP Server to load your new config file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl restart apache2
</span></span></code></pre></div><p>Now, monitor the logs to see when the new LetsEncrypt certificate arrives (<code>tail -F /var/log/apache2/error.log</code>), and then reload Apache one last time with the above <code>systemctl restart</code> command. After that you should be good to go!</p>
<p>Apache HTTP Server needs to be restart (or reloaded), every time <code>mod_md</code> gets a new certificate; see the module&rsquo;s docs for <a href="https://github.com/icing/mod_md#how-to-manage-server-reloads">more information</a>.</p>
<p>Depending on your version of Apache HTTP Server, you may see the following error: <code>error (specific information not available): acme problem urn:ietf:params:acme:error:invalidEmail: Error creating new account :: contact email &quot;webmaster@localhost&quot; has invalid domain : Domain name needs at least one dot</code></p>
<p>If this happens, you&rsquo;ll need to do one (or all) of the below:</p>
<ol>
<li>Update <code>/etc/apache2/sites-enabled/000-default.conf</code> and change the <code>ServerAdmin</code> value to a valid email address (then reload Apache HTTP Server).</li>
<li>Add the line <code>MDContactEmail your.email.address@whatever.com</code> below the <code>MDomain</code> line in <code>/etc/apache2/sites-available/example.com.conf</code>, replacing <code>your.email.address@whatever.com</code> with a valid email address, and <code>example.com</code> with your GtS host name.</li>
</ol>
<h3 id="tls-with-externally-managed-certificates">
  TLS with externally managed certificates
  <a class="anchor" href="#tls-with-externally-managed-certificates">#</a>
</h3>
<blockquote class="book-hint info">
  <p><strong>Note</strong></p>
<p>We have additional documentation on how to <a href="../../../advanced/certificates">provision TLS certificates</a> that also provides links to additional content and tutorials for different distributions that may be good to review.</p>

</blockquote>

<p>If you prefer to have a manual setup or setting SSL using a different service to manage it (Certbot, etc), then you can use a simpler setup for your Apache HTTP Server.</p>
<p>First we&rsquo;ll write a configuration for Apache HTTP Server and put it in <code>/etc/apache2/sites-available</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mkdir -p /etc/apache2/sites-available/
</span></span><span style="display:flex;"><span>sudoedit /etc/apache2/sites-available/example.com.conf
</span></span></code></pre></div><p>In the above <code>sudoedit</code> command, replace <code>example.com</code> with the hostname of your GoToSocial server.</p>
<p>The file you&rsquo;re about to create should look initially for both 80 (required) and 443 ports (optional) a bit like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-apache" data-lang="apache"><span style="display:flex;"><span><span style="color:#f92672">&lt;VirtualHost</span> <span style="color:#e6db74">*:80</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  ServerName example.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  RewriteEngine <span style="color:#66d9ef">On</span>
</span></span><span style="display:flex;"><span>  RewriteCond %{HTTP:Upgrade} websocket [NC]
</span></span><span style="display:flex;"><span>  RewriteCond %{HTTP:Connection} upgrade [NC]
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># set to 127.0.0.1 instead of localhost to work around https://stackoverflow.com/a/52550758</span>
</span></span><span style="display:flex;"><span>  RewriteRule ^/?(.*) <span style="color:#e6db74">&#34;ws://127.0.0.1:8080/$1&#34;</span> [P,L]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ProxyPreserveHost <span style="color:#66d9ef">On</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># set to 127.0.0.1 instead of localhost to work around https://stackoverflow.com/a/52550758</span>
</span></span><span style="display:flex;"><span>  ProxyPass / http://127.0.0.1:8080/
</span></span><span style="display:flex;"><span>  ProxyPassReverse / http://127.0.0.1:8080/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/VirtualHost&gt;</span>
</span></span></code></pre></div><p>Again, replace occurrences of <code>example.com</code> in the above config file with the hostname of your GtS server. If your domain name is <code>gotosocial.example.com</code>, then <code>gotosocial.example.com</code> would be the correct value.</p>
<p>You should also change <code>http://127.0.0.1:8080</code> to the correct address and port (if it&rsquo;s not on <code>127.0.0.1:8080</code>) of your GtS server. For example, if you&rsquo;re running GoToSocial on another machine with the local ip of <code>192.168.178.69</code> and on port <code>8080</code> then <code>http://192.168.178.69:8080/</code> would be the correct value.</p>
<p><code>Rewrite*</code> directives are needed to ensure that Websocket streaming connections also work. See the <a href="../websocket">websocket</a> document for more information on this.</p>
<p><code>ProxyPreserveHost On</code> is essential: It guarantees that the proxy and the GoToSocial speak of the same Server name. If not, GoToSocial will build the wrong authentication headers, and all attempts at federation will be rejected with 401 Unauthorized.</p>
<p>In the case of providing an initial setup for the 443 port looking for additional managing by an external tool, you could use default certificates provided by the server which you can find referenced in the <code>default-ssl.conf</code> file at <code>/etc/apache2/sites-available/</code>.</p>
<p>Save and close the config file.</p>
<p>Now we&rsquo;ll need to link the file we just created to the folder that Apache HTTP Server reads configurations for active sites from.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mkdir /etc/apache2/sites-enabled
</span></span><span style="display:flex;"><span>sudo ln -s /etc/apache2/sites-available/example.com.conf /etc/apache2/sites-enabled/
</span></span></code></pre></div><p>In the above <code>ln</code> command, replace <code>example.com</code> with the hostname of your GoToSocial server.</p>
<p>Now check for configuration errors.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apachectl -t
</span></span></code></pre></div><p>If everything is fine you should get this as output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Syntax OK
</span></span></code></pre></div><p>Everything working? Great! Then restart Apache HTTP Server to load your new config file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl restart apache2
</span></span></code></pre></div><h2 id="troubleshooting">
  Troubleshooting
  <a class="anchor" href="#troubleshooting">#</a>
</h2>
<p>If you cannot connect to the site in your browser, the reverse proxy setup doesn&rsquo;t work. Compare the Apache log file (<code>tail -F /var/log/apache2/access.log</code>) with the GoToSocial log file. Requests made must show up in both places. Double check the <code>ProxyPass</code> setting.</p>
<p>If you can connect but your posts don&rsquo;t federate and your account cannot be found from elsewhere, check your logs. Federation is broken if you see messages attempting to read your profile (something like <code>level=INFO … method=GET statusCode=401 path=/users/your_username msg=&quot;Unauthorized: …&quot;</code>) or post to your inbox (something like <code>level=INFO … method=POST statusCode=404 path=/your_username/inbox msg=&quot;Not Found: …&quot;</code>). Double check the <code>ProxyPreserveHost</code> setting.</p>
<p>If you can connect but you cannot authorize your account in a Mastodon client app, check your headers. Use <code>curl -I https://example.com</code> and look for the <code>Content-Security-Policy</code> header. If your webserver sets it, you might have to unset it. One way to do that is to use <code>Header unset Content-Security-Policy</code> in the Apache site config file (something like <code>example.com.conf</code>).</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#configure-gotosocial">Configure GoToSocial</a></li>
    <li><a href="#set-up-apache">Set up Apache</a>
      <ul>
        <li><a href="#required-apache-modules">Required Apache modules</a></li>
        <li><a href="#tls-with-mod_md">TLS with mod_md</a></li>
        <li><a href="#tls-with-externally-managed-certificates">TLS with externally managed certificates</a></li>
      </ul>
    </li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












